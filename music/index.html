<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå…‰éŸ³ä¹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* åŸºç¡€å˜é‡ï¼ˆé»˜è®¤æµ…è“è‰²ï¼Œç¨åç”±JSè¦†ç›–ï¼‰ */
        :root {
            --bg-color: #e6f0fa;
            --glass-bg: rgba(255, 255, 255, 0.6);
            --border-light: rgba(0, 0, 0, 0.05);
            --text-primary: #1e2a3a;
            --text-secondary: #2c3e50;
            --text-muted: #5a6b7c;
            --playlist-bg: rgba(255, 255, 255, 0.7);
            --playlist-item-bg: rgba(0, 0, 0, 0.02);
            --playlist-item-hover: rgba(100, 150, 200, 0.1);
            --active-gradient: #d4e6f1;
            --lyrics-text: #1e2a3a;
            --lyrics-active-text: #0066cc;
            --control-bg: rgba(255, 255, 255, 0.5);
            --button-color: #2c3e50;
            --button-hover-bg: rgba(100, 150, 200, 0.2);
            --progress-bg: rgba(0, 0, 0, 0.1);
            --progress-fill: #66a3d9;
            --progress-buffer: rgba(102, 163, 217, 0.3);
            --progress-thumb: #2c6b9e;
            --footer-color: #5a6b7c;
            --status-success: #10b981;
            --status-warning: #f59e0b;
            --status-error: #ef4444;
            --status-info: #3b82f6;
        }

        /* ä¸å†ä½¿ç”¨ body.dark-theme ç±»ï¼Œå…¨éƒ¨ç”± JS å˜é‡æ§åˆ¶ï¼Œä¿ç•™ç©ºç±»ä»¥é˜²ä¸‡ä¸€ */
        body.dark-theme { /* å¤‡ç”¨ï¼Œå®é™…ä¸ä½¿ç”¨ */ }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        html, body { height: 100%; width: 100%; overflow: hidden; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body {
            background: var(--bg-color);
            display: flex; align-items: stretch; justify-content: stretch;
            padding: 0 !important; transition: background 0.3s ease;
        }
        .glass-player {
            width: 100%; height: 100%; background: var(--glass-bg); backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px); border: none; border-radius: 0; padding: 16px;
            color: var(--text-primary); display: flex; flex-direction: column;
        }
        .main-content {
            width: 100%; height: 100%; display: flex; flex-direction: column; gap: 16px; overflow: hidden;
        }

        /* æ­Œå/ä½œè€…åŒºåŸŸ */
        .song-info-bar {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 4px; padding: 8px 0; text-align: center;
        }
        .song-title {
            font-size: 28px; font-weight: 800; line-height: 1.2;
            color: var(--text-primary);
        }
        .song-artist {
            font-size: 18px; font-weight: 400; color: var(--text-secondary);
        }

        /* æ­Œè¯åŒºåŸŸ */
        .lyrics-wrapper {
            width: 100%; flex: 1;
            background: transparent;
            border: none;
            padding: 8px 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
            font-size: 16px; line-height: 2;
            color: var(--lyrics-text);
            display: flex;
            flex-direction: column;
            scrollbar-width: thin;
        }
        .lyrics-line {
            color: var(--lyrics-text); transition: all 0.2s;
            padding: 4px 16px; border-radius: 0;
            white-space: pre-wrap; word-break: break-word;
            text-align: center; opacity: 0.8; margin: 2px 0;
        }
        .lyrics-line.active {
            font-weight: 800; color: var(--lyrics-active-text); opacity: 1;
            transform: scale(1.02);
        }
        .lyrics-line.chinese { font-size: 17px; }
        .lyrics-line.english { font-size: 15px; }
        .lyrics-loading { color: var(--text-muted); text-align: center; padding: 20px; margin: auto; }

        /* çŠ¶æ€æç¤º */
        #file-status {
            font-size: 13px; padding: 4px 12px; border-radius: 30px;
            background: rgba(0,0,0,0.05); color: var(--text-muted);
            text-align: center; max-width: 90%; margin: 0 auto;
        }
        #file-status.success { background: rgba(16,185,129,0.1); color: var(--status-success); }
        #file-status.warning { background: rgba(245,158,11,0.1); color: var(--status-warning); }
        #file-status.error { background: rgba(239,68,68,0.1); color: var(--status-error); }
        #file-status.info { background: rgba(59,130,246,0.1); color: var(--status-info); }

        /* æ§åˆ¶æ  (æ— éŸ³é‡) */
        .controls-bar {
            background: var(--control-bg); border-radius: 60px; padding: 16px 20px;
            border: 1px solid var(--border-light); backdrop-filter: blur(8px);
            display: flex; flex-wrap: wrap; align-items: center; gap: 16px;
            flex-shrink: 0; width: 100%;
        }
        .action-buttons {
            display: flex; gap: 16px; flex-shrink: 0; margin: 0 auto;
        }
        .action-buttons button {
            background: transparent; border: none; color: var(--button-color);
            font-size: 32px; cursor: pointer; width: 56px; height: 56px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; touch-action: manipulation;
        }
        .action-buttons button:hover { background: var(--button-hover-bg); color: var(--text-primary); }
        .progress-area {
            flex: 1; min-width: 200px; display: flex; align-items: center; gap: 8px;
        }
        .progress-time { font-size: 14px; color: var(--text-muted); min-width: 40px; text-align: center; }
        .slider-container { flex: 1; position: relative; height: 8px; cursor: pointer; }
        .progress-slider {
            position: absolute; width: 100%; height: 100%; -webkit-appearance: none;
            background: transparent; z-index: 2; outline: none;
        }
        .progress-buffer { position: absolute; width: 100%; height: 100%; background: var(--progress-bg); border-radius: 20px; overflow: hidden; }
        .progress-buffer-fill { height: 100%; background: var(--progress-buffer); border-radius: 20px; transition: width 0.1s; }
        .progress-played { position: absolute; top: 0; left: 0; height: 100%; background: var(--progress-fill); border-radius: 20px; pointer-events: none; z-index: 1; }
        .progress-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px; background: var(--progress-thumb);
            border-radius: 50%; box-shadow: 0 0 8px rgba(0,0,0,0.2); cursor: pointer; border: 2px solid white;
            margin-top: -5px; position: relative; z-index: 3;
        }
        .progress-slider::-webkit-slider-runnable-track { width: 100%; height: 8px; background: transparent; border-radius: 20px; }

        /* æ¨¡å¼/èœå•/ä¸»é¢˜æŒ‰é’®ç»„ */
        .mode-area {
            display: flex; gap: 8px; flex-shrink: 0; margin: 0 auto;
        }
        .mode-btn, .menu-btn, .palette-btn {
            background: transparent; border: none; color: var(--button-color);
            font-size: 24px; cursor: pointer; width: 44px; height: 44px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; touch-action: manipulation;
        }
        .mode-btn:hover, .menu-btn:hover, .palette-btn:hover { background: var(--button-hover-bg); color: var(--text-primary); }

        /* åº•éƒ¨ç‰ˆæƒ */
        .footer-note {
            font-size: 12px; color: var(--footer-color); margin-top: 8px;
            text-align: center; flex-shrink: 0;
        }

        /* æµ®çª—é€šç”¨æ ·å¼ */
        .playlist-panel, .theme-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; background: var(--playlist-bg);
            backdrop-filter: blur(20px); border-radius: 32px; padding: 20px 16px;
            border: 1px solid var(--border-light); box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            z-index: 1000; display: flex; flex-direction: column; gap: 12px;
        }
        .playlist-panel { max-width: 420px; max-height: 70vh; }
        .theme-panel { max-width: 300px; }
        .playlist-panel.hidden, .theme-panel.hidden { display: none; }
        .panel-header {
            display: flex; align-items: center; justify-content: space-between;
            padding-bottom: 8px; border-bottom: 1px solid var(--border-light);
        }
        .close-panel {
            background: transparent; border: none; color: var(--text-muted);
            font-size: 24px; cursor: pointer; width: 36px; height: 36px; border-radius: 50%;
        }
        .path-bar {
            background: rgba(0,0,0,0.05); border-radius: 30px; padding: 8px 16px;
            font-size: 14px; display: flex; align-items: center; gap: 6px; flex-wrap: wrap;
        }
        .path-item { cursor: pointer; color: var(--text-primary); font-weight: 500; padding: 2px 6px; border-radius: 16px; }
        .path-item:hover { background: var(--playlist-item-hover); }
        .file-list { list-style: none; overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 4px; }
        .file-item {
            padding: 10px 16px; border-radius: 24px; background: var(--playlist-item-bg);
            border: 1px solid transparent; font-size: 14px; color: var(--text-secondary);
            display: flex; align-items: center; gap: 12px; cursor: pointer;
        }
        .file-item:hover { background: var(--playlist-item-hover); border-color: var(--border-light); color: var(--text-primary); }
        .file-item.active { background: var(--active-gradient); border-color: var(--progress-fill); color: var(--text-primary); }
        .file-item i { width: 20px; text-align: center; color: var(--progress-fill); }
        .file-item.folder i { color: var(--text-muted); }
        .item-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* ä¸»é¢˜ç½‘æ ¼ */
        .theme-grid {
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;
            max-height: 60vh; overflow-y: auto; padding: 4px;
        }
        .theme-option {
            flex: 0 0 calc(50% - 6px);
            display: flex; align-items: center; gap: 8px;
            padding: 8px 12px; border-radius: 30px;
            background: var(--playlist-item-bg); cursor: pointer;
            transition: background 0.2s; border: 1px solid transparent;
        }
        .theme-option:hover { background: var(--playlist-item-hover); border-color: var(--border-light); }
        .color-swatch {
            width: 28px; height: 28px; border-radius: 50%;
            display: inline-block; flex-shrink: 0;
        }
        .theme-name {
            font-size: 14px; color: var(--text-secondary); flex: 1;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 700px) {
            .glass-player { padding: 12px; }
            .song-title { font-size: 24px; }
            .song-artist { font-size: 16px; }
            .lyrics-wrapper { padding: 8px 12px; font-size: 15px; }
            .controls-bar { flex-direction: column; gap: 12px; padding: 12px; border-radius: 40px; }
            .action-buttons { order: 0; gap: 20px; }
            .action-buttons button { width: 48px; height: 48px; font-size: 28px; }
            .progress-area { order: 1; width: 100%; }
            .mode-area { order: 2; width: 100%; justify-content: center; }
            .mode-btn, .menu-btn, .palette-btn { width: 40px; height: 40px; font-size: 22px; }
            .footer-note { font-size: 11px; }
            .theme-panel { max-width: 260px; }
            .theme-option { flex: 0 0 100%; }
        }
    </style>
</head>
<body>
<div class="glass-player">
    <div class="main-content">
        <!-- é¡¶éƒ¨æ­Œå/ä½œè€… -->
        <div class="song-info-bar">
            <span class="song-title" id="song-title">æœªæ’­æ”¾</span>
            <span class="song-artist" id="song-artist"></span>
        </div>

        <!-- æ­Œè¯åŒºåŸŸ -->
        <div class="lyrics-wrapper" id="lyrics-container">
            <div class="lyrics-loading">ğŸ•åŠ è½½æ­Œè¯ä¸­</div>
        </div>

        <!-- çŠ¶æ€æç¤ºè¡Œ -->
        <div id="file-status" class="info">åˆå§‹åŒ–ä¸­...</div>

        <!-- æ§åˆ¶æ  -->
        <div class="controls-bar">
            <div class="action-buttons">
                <button id="prev-btn"><i class="fas fa-step-backward"></i></button>
                <button id="play-pause-btn"><i class="fas fa-play-circle" id="play-icon"></i></button>
                <button id="next-btn"><i class="fas fa-step-forward"></i></button>
            </div>
            <div class="progress-area">
                <span class="progress-time" id="current-time">0:00</span>
                <div class="slider-container" id="slider-container">
                    <div class="progress-buffer"><div class="progress-buffer-fill" id="buffer-fill"></div></div>
                    <div class="progress-played" id="played-fill"></div>
                    <input type="range" class="progress-slider" id="progress-slider" value="0" step="0.1">
                </div>
                <span class="progress-time" id="duration-time">0:00</span>
            </div>
            <div class="mode-area">
                <button class="mode-btn" id="mode-btn" title="æ’­æ”¾æ¨¡å¼"><i class="fas fa-repeat" id="mode-icon"></i></button>
                <button class="menu-btn" id="menu-btn" title="æµè§ˆç›®å½•"><i class="fas fa-folder-open"></i></button>
                <button class="palette-btn" id="palette-btn" title="é€‰æ‹©ä¸»é¢˜"><i class="fas fa-palette"></i></button>
            </div>
        </div>

        <div class="footer-note">
            é‡‡ç”¨Githubå®˜æ–¹æºï¼Œå¯èƒ½å› ç½‘ç»œé—®é¢˜å¯¼è‡´æ­Œæ›²æ— æ³•æ’­æ”¾ã€æ— æ³•åŠ è½½æ­Œè¯ï¼Œæ•¬è¯·è°…è§£ã€‚<br/>
			è¯·ç­‰çŠ¶æ€æ¡å˜ä¸ºä¸»é¢˜è‰²åå†å¼€å§‹æ’­æ”¾ï¼
        </div>
    </div>

    <!-- æµ®çª—ç›®å½•é¢æ¿ -->
    <div class="playlist-panel hidden" id="playlist-panel">
        <div class="panel-header">
            <h3><i class="fas fa-folder-open"></i>é€‰æ‹©æ–‡ä»¶</h3>
            <button class="close-panel" id="close-panel-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="path-bar" id="path-bar"></div>
        <ul class="file-list" id="file-list-ul">
            <li class="loading"><i class="fas fa-spinner fa-pulse"></i> åŠ è½½ä¸­...</li>
        </ul>
    </div>

    <!-- ä¸»é¢˜é¢æ¿ -->
    <div class="theme-panel hidden" id="theme-panel">
        <div class="panel-header">
            <h3><i class="fas fa-palette"></i> é€‰æ‹©ä¸»é¢˜</h3>
            <button class="close-panel" id="close-theme-panel-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="theme-grid">
            <!-- æ·¡çº¢ -->
            <div class="theme-option" data-theme="red">
                <span class="color-swatch" style="background: #ffb3b3;"></span>
                <span class="theme-name">æ·¡çº¢</span>
            </div>
            <!-- æ·¡é»„ -->
            <div class="theme-option" data-theme="yellow">
                <span class="color-swatch" style="background: #fff2b5;"></span>
                <span class="theme-name">æ·¡é»„</span>
            </div>
            <!-- æ·¡ç»¿ -->
            <div class="theme-option" data-theme="green">
                <span class="color-swatch" style="background: #c2f0c2;"></span>
                <span class="theme-name">æ·¡ç»¿</span>
            </div>
            <!-- æ·¡è“ (é»˜è®¤) -->
            <div class="theme-option" data-theme="blue">
                <span class="color-swatch" style="background: #b8d9f5;"></span>
                <span class="theme-name">æ·¡è“</span>
            </div>
            <!-- æ·¡ç´« -->
            <div class="theme-option" data-theme="purple">
                <span class="color-swatch" style="background: #e0c2f0;"></span>
                <span class="theme-name">æ·¡ç´«</span>
            </div>
            <!-- æ·±è‰²æ¨¡å¼åˆ‡æ¢ (è‰²å—ç”¨æ·±ç°) -->
            <div class="theme-option" data-theme="dark">
                <span class="color-swatch" style="background: #555; border: 1px solid #aaa;"></span>
                <span class="theme-name">æ·±/æµ…è‰²</span>
            </div>
        </div>
    </div>
</div>

<audio id="audio-player" preload="metadata" crossorigin="anonymous"></audio>

<script>
    (function() {
        // ========== é»˜è®¤ä¸»é¢˜è®¾ç½® ==========
        // å¯é€‰ 'red', 'yellow', 'green', 'blue', 'purple'
        const DEFAULT_THEME = 'yellow';
        // =================================

        const audio = document.getElementById('audio-player');
        const fileListUl = document.getElementById('file-list-ul');
        const playlistPanel = document.getElementById('playlist-panel');
        const menuBtn = document.getElementById('menu-btn');
        const closePanelBtn = document.getElementById('close-panel-btn');
        const pathBar = document.getElementById('path-bar');

        const themePanel = document.getElementById('theme-panel');
        const paletteBtn = document.getElementById('palette-btn');
        const closeThemePanelBtn = document.getElementById('close-theme-panel-btn');
        const themeOptions = document.querySelectorAll('.theme-option');

        const songTitleSpan = document.getElementById('song-title');
        const songArtistSpan = document.getElementById('song-artist');
        const fileStatus = document.getElementById('file-status');
        const lyricsContainer = document.getElementById('lyrics-container');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressSlider = document.getElementById('progress-slider');
        const currentTimeSpan = document.getElementById('current-time');
        const durationSpan = document.getElementById('duration-time');
        const playedFill = document.getElementById('played-fill');
        const bufferFill = document.getElementById('buffer-fill');
        const modeBtn = document.getElementById('mode-btn');
        const modeIcon = document.getElementById('mode-icon');

        let playlist = [];
        let currentIndex = -1;
        let lyricsData = [];
        let lyricLinesElements = [];
        let isSeeking = false;
        let lastActiveIndices = [];

        let playMode = 0;
        const modeIcons = ['fa-repeat', 'fa-repeat-1', 'fa-random'];

        let currentPath = '';
        let currentFiles = [];

        // ä¸»é¢˜çŠ¶æ€
        let currentTheme = DEFAULT_THEME;   // å½“å‰æµ…è‰²ä¸»é¢˜å
        let isDark = false;                 // æ˜¯å¦æ·±è‰²æ¨¡å¼

        // å®šä¹‰æ¯ä¸ªä¸»é¢˜çš„æµ…è‰²å’Œæ·±è‰²å˜é‡
        const themeDefinitions = {
            red: {
                light: {
                    '--bg-color': '#ffe6e6',
                    '--glass-bg': 'rgba(255, 230, 230, 0.6)',
                    '--text-primary': '#2c1e1e',
                    '--text-secondary': '#4a2e2e',
                    '--text-muted': '#6b4a4a',
                    '--playlist-bg': 'rgba(255, 230, 230, 0.7)',
                    '--playlist-item-hover': 'rgba(255, 150, 150, 0.15)',
                    '--active-gradient': '#ffd9d9',
                    '--lyrics-text': '#2c1e1e',
                    '--lyrics-active-text': '#b30000',
                    '--control-bg': 'rgba(255, 220, 220, 0.5)',
                    '--button-color': '#4a2e2e',
                    '--button-hover-bg': 'rgba(255, 120, 120, 0.2)',
                    '--progress-fill': '#ff9999',
                    '--progress-buffer': 'rgba(255, 153, 153, 0.3)',
                    '--progress-thumb': '#cc7a7a',
                    '--footer-color': '#6b4a4a',
                    // å…¶ä»–å˜é‡ç»§æ‰¿é»˜è®¤å³å¯
                },
                dark: {
                    '--bg-color': '#3d2a2a',
                    '--glass-bg': 'rgba(50, 30, 30, 0.7)',
                    '--text-primary': '#f0d9d9',
                    '--text-secondary': '#d9b3b3',
                    '--text-muted': '#b38686',
                    '--playlist-bg': 'rgba(60, 35, 35, 0.8)',
                    '--playlist-item-hover': 'rgba(200, 100, 100, 0.2)',
                    '--active-gradient': '#5a4040',
                    '--lyrics-text': '#f0d9d9',
                    '--lyrics-active-text': '#ff9999',
                    '--control-bg': 'rgba(70, 40, 40, 0.5)',
                    '--button-color': '#f0d9d9',
                    '--button-hover-bg': 'rgba(200, 100, 100, 0.3)',
                    '--progress-fill': '#cc7a7a',
                    '--progress-buffer': 'rgba(204, 122, 122, 0.4)',
                    '--progress-thumb': '#b36666',
                    '--footer-color': '#b38686',
                }
            },
            yellow: {
                light: {
                    '--bg-color': '#fff9e6',
                    '--glass-bg': 'rgba(255, 249, 230, 0.6)',
                    '--text-primary': '#3d351f',
                    '--text-secondary': '#5e532f',
                    '--text-muted': '#7f7242',
                    '--playlist-bg': 'rgba(255, 249, 230, 0.7)',
                    '--playlist-item-hover': 'rgba(255, 220, 100, 0.15)',
                    '--active-gradient': '#fff0cc',
                    '--lyrics-text': '#3d351f',
                    '--lyrics-active-text': '#b38f00',
                    '--control-bg': 'rgba(255, 245, 200, 0.5)',
                    '--button-color': '#5e532f',
                    '--button-hover-bg': 'rgba(255, 200, 80, 0.2)',
                    '--progress-fill': '#ffe066',
                    '--progress-buffer': 'rgba(255, 224, 102, 0.3)',
                    '--progress-thumb': '#ccaa55',
                    '--footer-color': '#7f7242',
                },
                dark: {
                    '--bg-color': '#4d442b',
                    '--glass-bg': 'rgba(60, 50, 30, 0.7)',
                    '--text-primary': '#fff2cc',
                    '--text-secondary': '#e6d9b3',
                    '--text-muted': '#ccb380',
                    '--playlist-bg': 'rgba(70, 60, 35, 0.8)',
                    '--playlist-item-hover': 'rgba(220, 180, 80, 0.2)',
                    '--active-gradient': '#665c40',
                    '--lyrics-text': '#fff2cc',
                    '--lyrics-active-text': '#ffe066',
                    '--control-bg': 'rgba(80, 70, 40, 0.5)',
                    '--button-color': '#fff2cc',
                    '--button-hover-bg': 'rgba(220, 180, 80, 0.3)',
                    '--progress-fill': '#ccaa55',
                    '--progress-buffer': 'rgba(204, 170, 85, 0.4)',
                    '--progress-thumb': '#b39246',
                    '--footer-color': '#ccb380',
                }
            },
            green: {
                light: {
                    '--bg-color': '#e6f7e6',
                    '--glass-bg': 'rgba(230, 247, 230, 0.6)',
                    '--text-primary': '#1e3a1e',
                    '--text-secondary': '#2e5e2e',
                    '--text-muted': '#3f823f',
                    '--playlist-bg': 'rgba(230, 247, 230, 0.7)',
                    '--playlist-item-hover': 'rgba(100, 200, 100, 0.15)',
                    '--active-gradient': '#c6e6c6',
                    '--lyrics-text': '#1e3a1e',
                    '--lyrics-active-text': '#2d862d',
                    '--control-bg': 'rgba(220, 245, 220, 0.5)',
                    '--button-color': '#2e5e2e',
                    '--button-hover-bg': 'rgba(80, 180, 80, 0.2)',
                    '--progress-fill': '#99cc99',
                    '--progress-buffer': 'rgba(153, 204, 153, 0.3)',
                    '--progress-thumb': '#5c9e5c',
                    '--footer-color': '#3f823f',
                },
                dark: {
                    '--bg-color': '#2b472b',
                    '--glass-bg': 'rgba(30, 60, 30, 0.7)',
                    '--text-primary': '#d9f0d9',
                    '--text-secondary': '#b3d9b3',
                    '--text-muted': '#8cb38c',
                    '--playlist-bg': 'rgba(35, 70, 35, 0.8)',
                    '--playlist-item-hover': 'rgba(100, 180, 100, 0.2)',
                    '--active-gradient': '#406040',
                    '--lyrics-text': '#d9f0d9',
                    '--lyrics-active-text': '#99cc99',
                    '--control-bg': 'rgba(40, 80, 40, 0.5)',
                    '--button-color': '#d9f0d9',
                    '--button-hover-bg': 'rgba(100, 180, 100, 0.3)',
                    '--progress-fill': '#5c9e5c',
                    '--progress-buffer': 'rgba(92, 158, 92, 0.4)',
                    '--progress-thumb': '#4d864d',
                    '--footer-color': '#8cb38c',
                }
            },
            blue: {
                light: {
                    '--bg-color': '#e6f0fa',
                    '--glass-bg': 'rgba(255, 255, 255, 0.6)',
                    '--text-primary': '#1e2a3a',
                    '--text-secondary': '#2c3e50',
                    '--text-muted': '#5a6b7c',
                    '--playlist-bg': 'rgba(255, 255, 255, 0.7)',
                    '--playlist-item-hover': 'rgba(100, 150, 200, 0.1)',
                    '--active-gradient': '#d4e6f1',
                    '--lyrics-text': '#1e2a3a',
                    '--lyrics-active-text': '#0066cc',
                    '--control-bg': 'rgba(255, 255, 255, 0.5)',
                    '--button-color': '#2c3e50',
                    '--button-hover-bg': 'rgba(100, 150, 200, 0.2)',
                    '--progress-fill': '#66a3d9',
                    '--progress-buffer': 'rgba(102, 163, 217, 0.3)',
                    '--progress-thumb': '#2c6b9e',
                    '--footer-color': '#5a6b7c',
                },
                dark: {
                    '--bg-color': '#1a2632',
                    '--glass-bg': 'rgba(30, 40, 50, 0.7)',
                    '--text-primary': '#e0f0ff',
                    '--text-secondary': '#c0d4e8',
                    '--text-muted': '#a0b8cc',
                    '--playlist-bg': 'rgba(30, 40, 50, 0.8)',
                    '--playlist-item-hover': 'rgba(100, 150, 200, 0.2)',
                    '--active-gradient': '#2a4055',
                    '--lyrics-text': '#c0d4e8',
                    '--lyrics-active-text': '#99ccff',
                    '--control-bg': 'rgba(30, 40, 50, 0.5)',
                    '--button-color': '#c0d4e8',
                    '--button-hover-bg': 'rgba(100, 150, 200, 0.3)',
                    '--progress-fill': '#3b6e9e',
                    '--progress-buffer': 'rgba(59, 110, 158, 0.4)',
                    '--progress-thumb': '#77aadd',
                    '--footer-color': '#a0b8cc',
                }
            },
            purple: {
                light: {
                    '--bg-color': '#f0e6fa',
                    '--glass-bg': 'rgba(240, 230, 250, 0.6)',
                    '--text-primary': '#2a1e3a',
                    '--text-secondary': '#3e2e5e',
                    '--text-muted': '#523e82',
                    '--playlist-bg': 'rgba(240, 230, 250, 0.7)',
                    '--playlist-item-hover': 'rgba(170, 120, 200, 0.15)',
                    '--active-gradient': '#e1d1f0',
                    '--lyrics-text': '#2a1e3a',
                    '--lyrics-active-text': '#5b3d8a',
                    '--control-bg': 'rgba(235, 220, 245, 0.5)',
                    '--button-color': '#3e2e5e',
                    '--button-hover-bg': 'rgba(150, 100, 200, 0.2)',
                    '--progress-fill': '#b399cc',
                    '--progress-buffer': 'rgba(179, 153, 204, 0.3)',
                    '--progress-thumb': '#7a5c9e',
                    '--footer-color': '#523e82',
                },
                dark: {
                    '--bg-color': '#352b47',
                    '--glass-bg': 'rgba(40, 30, 50, 0.7)',
                    '--text-primary': '#ecd9ff',
                    '--text-secondary': '#d9b3ff',
                    '--text-muted': '#b386e6',
                    '--playlist-bg': 'rgba(50, 35, 60, 0.8)',
                    '--playlist-item-hover': 'rgba(150, 100, 180, 0.2)',
                    '--active-gradient': '#4f4266',
                    '--lyrics-text': '#ecd9ff',
                    '--lyrics-active-text': '#cc99ff',
                    '--control-bg': 'rgba(60, 40, 70, 0.5)',
                    '--button-color': '#ecd9ff',
                    '--button-hover-bg': 'rgba(150, 100, 180, 0.3)',
                    '--progress-fill': '#7a5c9e',
                    '--progress-buffer': 'rgba(122, 92, 158, 0.4)',
                    '--progress-thumb': '#9f7ac4',
                    '--footer-color': '#b386e6',
                }
            }
        };

        // åº”ç”¨ä¸»é¢˜ï¼šæ ¹æ®å½“å‰ theme å’Œ isDark è®¾ç½® CSS å˜é‡
        function applyTheme() {
            const theme = themeDefinitions[currentTheme];
            if (!theme) return;
            const vars = isDark ? theme.dark : theme.light;
            const root = document.documentElement;
            for (let [key, value] of Object.entries(vars)) {
                root.style.setProperty(key, value);
            }
        }

        // å¤„ç†ä¸»é¢˜é€‰é¡¹ç‚¹å‡»
        function onThemeOptionClick(theme) {
            if (theme === 'dark') {
                // æ·±è‰²æ¨¡å¼åˆ‡æ¢ï¼šåˆ‡æ¢ isDark çŠ¶æ€ï¼Œç„¶åé‡æ–°åº”ç”¨å½“å‰ä¸»é¢˜çš„æ·±è‰²/æµ…è‰²
                isDark = !isDark;
                applyTheme();
            } else {
                // ç‚¹å‡»æµ…è‰²ä¸»é¢˜ï¼šè®¾ç½®å½“å‰ä¸»é¢˜ï¼Œå¹¶å¼ºåˆ¶ä¸ºæµ…è‰²æ¨¡å¼
                currentTheme = theme;
                isDark = false;
                applyTheme();
            }
            // å…³é—­ä¸»é¢˜é¢æ¿
            themePanel.classList.add('hidden');
        }

        // æ‰“å¼€/å…³é—­ä¸»é¢˜é¢æ¿
        paletteBtn.addEventListener('click', () => {
            themePanel.classList.remove('hidden');
        });
        closeThemePanelBtn.addEventListener('click', () => {
            themePanel.classList.add('hidden');
        });
        themePanel.addEventListener('click', (e) => {
            if (e.target === themePanel) themePanel.classList.add('hidden');
        });

        // ç»™æ¯ä¸ªä¸»é¢˜é€‰é¡¹ç»‘å®šäº‹ä»¶
        themeOptions.forEach(opt => {
            opt.addEventListener('click', () => {
                const theme = opt.dataset.theme;
                onThemeOptionClick(theme);
            });
        });

        // æ­Œå•é¢æ¿é€»è¾‘
        menuBtn.addEventListener('click', () => {
            playlistPanel.classList.remove('hidden');
            refreshFileList();
        });
        closePanelBtn.addEventListener('click', () => playlistPanel.classList.add('hidden'));
        playlistPanel.addEventListener('click', (e) => {
            if (e.target === playlistPanel) playlistPanel.classList.add('hidden');
        });

        function updateStatus(message, type = 'info') {
            fileStatus.className = '';
            fileStatus.classList.add(type);
            fileStatus.textContent = message;
        }

        function togglePlayMode() {
            playMode = (playMode + 1) % 3;
            modeIcon.className = 'fas ' + modeIcons[playMode];
            updateStatus(`æ’­æ”¾æ¨¡å¼: ${['é¡ºåº', 'å•æ›²å¾ªç¯', 'éšæœº'][playMode]}`, 'info');
        }
        modeBtn.addEventListener('click', togglePlayMode);

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function parseFileName(filename) {
            const name = filename.replace(/\.mp3$/i, '');
            const match = name.match(/^(.*?)\s*-\s*(.*)$/);
            if (match) {
                return { title: match[1].trim(), artist: match[2].trim() };
            }
            return { title: name, artist: 'æœªçŸ¥æ­Œæ‰‹' };
        }

        function detectLanguage(text) {
            const cleanText = text.trim();
            if (!cleanText) return 'unknown';
            const chineseRegex = /[\u4e00-\u9fff]/;
            const englishRegex = /[a-zA-Z]/;
            const hasChinese = chineseRegex.test(cleanText);
            const hasEnglish = englishRegex.test(cleanText);
            if (hasChinese && !hasEnglish) return 'chinese';
            else if (hasEnglish && !hasChinese) return 'english';
            else if (hasChinese && hasEnglish) {
                const chineseCount = (cleanText.match(chineseRegex) || []).length;
                const englishCount = (cleanText.match(englishRegex) || []).length;
                return chineseCount >= englishCount ? 'chinese' : 'english';
            } else return 'english';
        }

        function parseLRC(lrcText) {
            const lines = lrcText.split('\n');
            const result = [];
            const timeRegex = /\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?]/g;
            lines.forEach(line => {
                let match;
                const times = [];
                while ((match = timeRegex.exec(line)) !== null) {
                    const min = parseInt(match[1], 10);
                    const sec = parseInt(match[2], 10);
                    const ms = parseInt(match[3] || '0', 10);
                    const seconds = min * 60 + sec + ms / 1000;
                    times.push(seconds);
                }
                if (times.length > 0) {
                    let text = line.replace(timeRegex, '').trim();
                    if (text === '') text = ' ';
                    const lang = detectLanguage(text);
                    times.forEach(t => {
                        result.push({ time: t, text: text, lang: lang });
                    });
                }
            });
            result.sort((a, b) => a.time - b.time);
            return result;
        }

        function renderLyrics(lyricsArray) {
            lyricsContainer.innerHTML = '';
            if (!lyricsArray || lyricsArray.length === 0) {
                lyricsContainer.innerHTML = '<div class="lyrics-loading">æš‚æ— æ­Œè¯</div>';
                lyricLinesElements = [];
                return;
            }
            const fragment = document.createDocumentFragment();
            const elements = [];
            lyricsArray.forEach((item) => {
                const div = document.createElement('div');
                div.className = `lyrics-line ${item.lang}`;
                div.setAttribute('data-time', item.time);
                div.textContent = item.text || ' ';
                fragment.appendChild(div);
                elements.push({ element: div, time: item.time, lang: item.lang });
            });
            lyricsContainer.appendChild(fragment);
            lyricLinesElements = elements;
            lastActiveIndices = [];
        }

        function getHighlightIndices(currentTime, lyricsData, threshold = 0.3) {
            if (!lyricsData.length) return [];
            let activeIndex = -1;
            for (let i = 0; i < lyricsData.length; i++) {
                if (lyricsData[i].time <= currentTime) activeIndex = i;
                else break;
            }
            if (activeIndex === -1) return [];
            const indices = [activeIndex];
            const activeLang = lyricsData[activeIndex].lang;
            if (activeLang === 'english' && activeIndex + 1 < lyricsData.length) {
                const next = lyricsData[activeIndex + 1];
                if (next.lang === 'chinese' && (next.time - lyricsData[activeIndex].time) < threshold) {
                    indices.push(activeIndex + 1);
                }
            } else if (activeLang === 'chinese' && activeIndex - 1 >= 0) {
                const prev = lyricsData[activeIndex - 1];
                if (prev.lang === 'english' && (lyricsData[activeIndex].time - prev.time) < threshold) {
                    indices.unshift(activeIndex - 1);
                }
            }
            return indices;
        }

        function updateLyricsHighlight(currentTime) {
            if (!lyricLinesElements.length || !lyricsData.length) return;
            const activeIndices = getHighlightIndices(currentTime, lyricsData);
            lyricLinesElements.forEach(item => item.element.classList.remove('active'));
            activeIndices.forEach(idx => {
                if (idx >= 0 && idx < lyricLinesElements.length) {
                    lyricLinesElements[idx].element.classList.add('active');
                }
            });
            if (activeIndices.length > 0) {
                const container = lyricsContainer;
                const firstIdx = activeIndices[0];
                const lastIdx = activeIndices[activeIndices.length - 1];
                const firstElement = lyricLinesElements[firstIdx].element;
                const lastElement = lyricLinesElements[lastIdx].element;

                const containerRect = container.getBoundingClientRect();
                const firstRect = firstElement.getBoundingClientRect();
                const lastRect = lastElement.getBoundingClientRect();

                const groupTop = firstRect.top - containerRect.top;
                const groupBottom = lastRect.bottom - containerRect.top;
                const groupHeight = groupBottom - groupTop;
                const groupMiddle = groupTop + groupHeight / 2;

                const targetScrollTop = container.scrollTop + groupMiddle - container.clientHeight / 2;
                container.scrollTo({ top: targetScrollTop, behavior: 'smooth' });
            }
            lastActiveIndices = activeIndices;
        }

        function updateProgress() {
            if (audio.duration) {
                playedFill.style.width = (audio.currentTime / audio.duration * 100) + '%';
            }
            if (audio.buffered.length > 0) {
                const bufferedEnd = audio.buffered.end(audio.buffered.length - 1);
                bufferFill.style.width = (bufferedEnd / audio.duration * 100) + '%';
            }
        }

        function getNextIndex(forward = true) {
            if (playlist.length === 0) return -1;
            if (playMode === 1) return currentIndex;
            if (playMode === 2) {
                if (playlist.length === 1) return 0;
                let newIndex;
                do { newIndex = Math.floor(Math.random() * playlist.length); } while (newIndex === currentIndex);
                return newIndex;
            } else {
                return forward ? (currentIndex + 1) % playlist.length : (currentIndex - 1 + playlist.length) % playlist.length;
            }
        }

        function loadSong(index) {
            if (index < 0 || index >= playlist.length) { updateStatus('æ— æ•ˆæ­Œæ›²', 'error'); return; }
            const song = playlist[index];
            currentIndex = index;
            songTitleSpan.textContent = song.title;
            songArtistSpan.textContent = song.artist;
            updateStatus(`åŠ è½½: ${song.title}`, 'info');

            document.querySelectorAll('.file-item').forEach(item => item.classList.remove('active'));

            audio.src = '';
            audio.load();
            try {
                audio.src = song.audioUrl;
                audio.load();
                updateStatus('éŸ³é¢‘åŠ è½½ä¸­...', 'info');
            } catch (e) { updateStatus(`éŸ³é¢‘å¼‚å¸¸: ${e.message}`, 'error'); }

            if (song.lrcUrl) {
                updateStatus('åŠ è½½æ­Œè¯...', 'info');
                fetch(song.lrcUrl, { mode: 'cors' })
                    .then(res => res.ok ? res.text() : Promise.reject('æ­Œè¯è·å–å¤±è´¥'))
                    .then(lrcText => {
                        lyricsData = parseLRC(lrcText);
                        renderLyrics(lyricsData);
                        updateStatus(`æ­Œè¯å®Œæˆ (${lyricsData.length}è¡Œ)`, 'success');
                    })
                    .catch(err => {
                        console.warn(err);
                        lyricsData = [];
                        renderLyrics([]);
                        updateStatus('æ­Œè¯åŠ è½½å¤±è´¥', 'warning');
                    });
            } else {
                lyricsData = [];
                renderLyrics([]);
                updateStatus('æ— æ­Œè¯', 'info');
            }

            if (!audio.paused) { audio.pause(); playIcon.className = 'fas fa-play-circle'; }
            progressSlider.value = 0;
            playedFill.style.width = '0%';
            bufferFill.style.width = '0%';
            currentTimeSpan.textContent = '0:00';
            durationSpan.textContent = '0:00';
        }

        function renderFileList(files, path) {
            fileListUl.innerHTML = '';
            pathBar.innerHTML = '';

            const parts = path ? path.split('/') : [];
            let accumulated = '';
            const rootSpan = document.createElement('span');
            rootSpan.className = 'path-item';
            rootSpan.textContent = 'ğŸ  æ ¹ç›®å½•';
            rootSpan.addEventListener('click', () => navigateTo(''));
            pathBar.appendChild(rootSpan);
            parts.forEach((part, idx) => {
                const sep = document.createElement('span');
                sep.className = 'path-separator';
                sep.textContent = 'â€º';
                pathBar.appendChild(sep);
                const span = document.createElement('span');
                span.className = 'path-item';
                span.textContent = part;
                accumulated += (accumulated ? '/' : '') + part;
                span.addEventListener('click', () => navigateTo(accumulated));
                pathBar.appendChild(span);
            });

            if (path) {
                const backLi = document.createElement('li');
                backLi.className = 'file-item back';
                backLi.innerHTML = `<i class="fas fa-arrow-left"></i><span class="item-name">.. è¿”å›ä¸Šçº§</span>`;
                backLi.addEventListener('click', () => {
                    const parent = path.split('/').slice(0, -1).join('/');
                    navigateTo(parent);
                });
                fileListUl.appendChild(backLi);
            }

            const folders = files.filter(f => f.type === 'dir').sort((a,b) => a.name.localeCompare(b.name));
            folders.forEach(f => {
                const li = document.createElement('li');
                li.className = 'file-item folder';
                li.innerHTML = `<i class="fas fa-folder"></i><span class="item-name">${f.name}</span>`;
                li.addEventListener('click', () => navigateTo(f.path));
                fileListUl.appendChild(li);
            });

            const mp3Files = files.filter(f => f.type === 'file' && f.name.toLowerCase().endsWith('.mp3')).sort((a,b) => a.name.localeCompare(b.name));
            mp3Files.forEach(f => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `<i class="fas fa-music"></i><span class="item-name">${f.name.replace(/\.mp3$/i, '')}</span>`;
                li.addEventListener('click', () => {
                    buildPlaylistFromCurrentDir(f);
                });
                fileListUl.appendChild(li);
            });

            if (folders.length === 0 && mp3Files.length === 0) {
                fileListUl.innerHTML = '<li class="file-item" style="justify-content:center;">ğŸ“‚ ç©ºæ–‡ä»¶å¤¹</li>';
            }
        }

        function buildPlaylistFromCurrentDir(clickedFile) {
            const mp3s = currentFiles.filter(f => f.type === 'file' && f.name.toLowerCase().endsWith('.mp3'));
            const lrcMap = new Map();
            currentFiles.forEach(f => {
                if (f.type === 'file' && f.name.toLowerCase().endsWith('.lrc')) {
                    const base = f.name.slice(0, -4).toLowerCase();
                    lrcMap.set(base, f.download_url);
                }
            });

            const newPlaylist = mp3s.map(mp3 => {
                const base = mp3.name.slice(0, -4).toLowerCase();
                const { title, artist } = parseFileName(mp3.name);
                return {
                    name: mp3.name,
                    title: title,
                    artist: artist,
                    audioUrl: mp3.download_url,
                    lrcUrl: lrcMap.get(base) || null
                };
            });
            playlist = newPlaylist;

            const clickedBase = clickedFile.name.slice(0, -4).toLowerCase();
            const targetIndex = playlist.findIndex(s => s.name.toLowerCase() === clickedFile.name.toLowerCase());
            if (targetIndex !== -1) {
                loadSong(targetIndex);
                audio.play().then(() => {
                    playIcon.className = 'fas fa-pause-circle';
                    updateStatus(`æ’­æ”¾: ${playlist[targetIndex].title}`, 'success');
                }).catch(e => updateStatus(`æ’­æ”¾å¤±è´¥: ${e.message}`, 'error'));
            }
            renderFileList(currentFiles, currentPath);
        }

        function navigateTo(path) {
            currentPath = path;
            updateStatus(`è¿›å…¥ ${path || 'æ ¹ç›®å½•'}...`, 'info');
            fetchMusicList(path);
        }

        function fetchMusicList(path = '') {
            const apiUrl = `https://api.github.com/repos/amaxyzdog/music/contents/${path}`;
            updateStatus('è·å–ç›®å½•...', 'info');
            fetch(apiUrl, { headers: { 'Accept': 'application/json' } })
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                })
                .then(data => {
                    if (!Array.isArray(data)) throw new Error('ä¸æ˜¯ç›®å½•');
                    currentFiles = data.map(item => ({
                        name: item.name,
                        type: item.type,
                        path: item.path,
                        download_url: item.download_url || null
                    }));
                    renderFileList(currentFiles, currentPath);
                    updateStatus(`åŠ è½½å®Œæˆ`, 'success');
                })
                .catch(err => {
                    console.error(err);
                    updateStatus(`åŠ è½½å¤±è´¥: ${err.message}`, 'error');
                    fileListUl.innerHTML = `<li class="file-item" style="color:var(--status-error);"><i class="fas fa-exclamation-triangle"></i> ${err.message}</li>`;
                });
        }

        function refreshFileList() {
            fetchMusicList(currentPath);
        }

        function init() {
            updateStatus('åˆå§‹åŒ–...', 'info');
            // åº”ç”¨é»˜è®¤ä¸»é¢˜
            applyTheme();
            fetchMusicList('');

            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', playPrev);
            nextBtn.addEventListener('click', playNext);
            audio.addEventListener('timeupdate', onTimeUpdate);
            audio.addEventListener('progress', onProgress);
            audio.addEventListener('loadedmetadata', onLoadedMetadata);
            audio.addEventListener('ended', onEnded);
            audio.addEventListener('error', (e) => {
                const err = e.target.error;
                const msg = err ? (err.code ? {1:'ä¸­æ­¢',2:'ç½‘ç»œ',3:'è§£ç ',4:'ä¸å¯ç”¨'}[err.code] : 'æœªçŸ¥') : 'æœªçŸ¥';
                updateStatus(`éŸ³é¢‘é”™è¯¯: ${msg}`, 'error');
                playIcon.className = 'fas fa-play-circle';
            });
            progressSlider.addEventListener('input', onSliderInput);
            progressSlider.addEventListener('change', onSliderChange);
            audio.volume = 1.0;
            audio.addEventListener('play', () => {
                playIcon.className = 'fas fa-pause-circle';
                updateStatus('æ’­æ”¾ä¸­', 'success');
            });
            audio.addEventListener('pause', () => {
                playIcon.className = 'fas fa-play-circle';
                updateStatus('å·²æš‚åœ', 'info');
            });
            lyricsContainer.addEventListener('touchmove', (e) => e.stopPropagation(), { passive: true });
            window.addEventListener('resize', () => { if (audio.currentTime) updateLyricsHighlight(audio.currentTime); });
            window.addEventListener('online', () => updateStatus('ç½‘ç»œå·²æ¢å¤', 'success'));
            window.addEventListener('offline', () => updateStatus('ç½‘ç»œå·²æ–­å¼€', 'error'));
        }

        function togglePlayPause() {
            if (!audio.src) { updateStatus('æš‚æ— éŸ³é¢‘', 'warning'); return; }
            if (audio.paused) {
                audio.play().catch(e => updateStatus(`æ’­æ”¾å¤±è´¥: ${e.message}`, 'error'));
            } else {
                audio.pause();
            }
        }

        function onTimeUpdate() {
            if (isSeeking) return;
            const current = audio.currentTime || 0;
            const duration = audio.duration || 0;
            progressSlider.max = duration || 100;
            progressSlider.value = current;
            currentTimeSpan.textContent = formatTime(current);
            durationSpan.textContent = formatTime(duration);
            updateProgress();
            updateLyricsHighlight(current);
        }

        function onProgress() { updateProgress(); }
        function onLoadedMetadata() {
            durationSpan.textContent = formatTime(audio.duration);
            progressSlider.max = audio.duration || 0;
        }
        function onSliderInput() {
            isSeeking = true;
            currentTimeSpan.textContent = formatTime(progressSlider.value);
        }
        function onSliderChange() {
            audio.currentTime = progressSlider.value;
            isSeeking = false;
            updateLyricsHighlight(audio.currentTime);
        }
        function playPrev() {
            if (playlist.length === 0) return;
            let newIndex = getNextIndex(false);
            loadSong(newIndex);
            audio.play().catch(e => updateStatus(`æ’­æ”¾å¤±è´¥: ${e.message}`, 'error'));
        }
        function playNext() {
            if (playlist.length === 0) return;
            let newIndex = getNextIndex(true);
            loadSong(newIndex);
            audio.play().catch(e => updateStatus(`æ’­æ”¾å¤±è´¥: ${e.message}`, 'error'));
        }
        function onEnded() {
            if (playMode === 1) {
                audio.currentTime = 0;
                audio.play().catch(e => updateStatus(`å¾ªç¯å¤±è´¥: ${e.message}`, 'error'));
            } else {
                playNext();
            }
        }

        init();
    })();
</script>
</body>
</html>