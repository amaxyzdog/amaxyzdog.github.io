<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>罗小黑2-720p</title>
    <!-- 引入国内轻量级Layui (仅16KB，国内CDN更快) -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/layui/2.9.16/css/layui.min.css">
    <!-- 引入国内版Font Awesome (阿里CDN) -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 自定义样式 (精简且高性能) -->
    <style>
        /* 全局样式重置与基础设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", "微软雅黑", -apple-system, sans-serif;
        }
        
        body {
            background-color: #f2f2f2;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        /* 播放器容器 */
        .player-container {
            max-width: 1280px;
            width: 100%;
            background-color: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* 视频容器 */
        .video-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
        }
        
        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        
        /* 控制层 - 性能优化：减少重绘重排 */
        .controls-layer {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, transparent 100%);
            opacity: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 0.8rem;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        
        .video-wrapper:hover .controls-layer {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* 进度条容器 - 核心优化：实现高亮效果 */
        .progress-container {
            margin-bottom: 0.8rem;
            padding: 0 0.3rem;
            position: relative;
            height: 3px;
        }
        
        /* 进度条背景轨道 */
        .progress-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #444;
            border-radius: 2px;
        }
        
        /* 已播放进度高亮条 */
        .progress-filled {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #1E9FFF; /* Layui主色调 */
            border-radius: 2px;
            width: 0%;
            /* 丝滑过渡效果 */
            transition: width 0.1s ease-out;
        }
        
        /* 进度条滑块 - 核心优化：丝滑交互 */
        #progressBar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            outline: none;
            cursor: pointer;
            z-index: 10;
        }
        
        /* 滑块样式优化 */
        #progressBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #1E9FFF;
            cursor: pointer;
            /* 丝滑缩放效果 */
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* 解决点击区域问题 */
            margin-top: -4.5px;
        }
        
        #progressBar::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #1E9FFF;
            cursor: pointer;
            border: none;
            /* 丝滑缩放效果 */
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* 滑块hover/active效果 */
        #progressBar::-webkit-slider-thumb:hover {
            transform: scale(1.5);
        }
        
        #progressBar::-moz-range-thumb:hover {
            transform: scale(1.5);
        }
        
        #progressBar:hover + .progress-track {
            height: 5px;
            top: -1px;
        }
        
        #progressBar:hover ~ .progress-filled {
            height: 5px;
            top: -1px;
        }
        
        /* 音量滑块样式 */
        input[type="range"].volume-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 3px;
            border-radius: 2px;
            background: #444;
            outline: none;
            cursor: pointer;
            transition: height 0.1s ease;
        }
        
        input[type="range"].volume-slider:hover {
            height: 5px;
        }
        
        input[type="range"].volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #1E9FFF;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        
        input[type="range"].volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #1E9FFF;
            cursor: pointer;
            border: none;
        }
        
        input[type="range"].volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.3);
        }
        
        /* 控制按钮组 */
        .controls-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
        }
        
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .volume-controls {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        /* 按钮样式 - 国内审美优化 */
        .control-btn {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 0.95rem;
            cursor: pointer;
            padding: 0.4rem;
            border-radius: 50%;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background-color: rgba(30, 159, 255, 0.8);
            transform: scale(1.05);
        }
        
        /* 时间显示 */
        .time-display {
            font-size: 0.8rem;
            color: #fff;
            min-width: 70px;
        }
        
        /* 播放速度选择器 */
        #speedSelect {
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 0.2rem 0.4rem;
            font-size: 0.8rem;
            outline: none;
            cursor: pointer;
        }
        
        #speedSelect:focus {
            box-shadow: 0 0 0 2px rgba(30, 159, 255, 0.5);
        }
        
        /* 性能优化：硬件加速 */
        .video-wrapper, .controls-layer, .control-btn, .progress-filled {
            transform: translateZ(0);
        }
    </style>
</head>
<body>
    <div class="player-container">
        <!-- 视频容器 -->
        <div class="video-wrapper" id="videoContainer">
            <video 
                id="videoPlayer" 
                <!-- 替换为你本地文件夹中的封面图路径 -->
                poster="./cover.jpg"  <!-- 同级文件夹下的cover.jpg，可改为具体路径如：./images/封面图.png -->
                preload="metadata"
            >
                <!-- 替换为你的视频链接 -->
                <source src="https://www.w3school.com.cn/i/movie.mp4" type="video/mp4">
                您的浏览器不支持HTML5视频播放
            </video>
            
            <!-- 播放器控制层 -->
            <div class="controls-layer">
                <!-- 进度条 - 重构为多层结构实现高亮 -->
                <div class="progress-container">
                    <div class="progress-track"></div>
                    <div class="progress-filled" id="progressFilled"></div>
                    <input 
                        type="range" 
                        id="progressBar" 
                        min="0" 
                        max="100" 
                        value="0"
                    >
                </div>
                
                <!-- 控制按钮组 -->
                <div class="controls-group">
                    <div class="left-controls">
                        <!-- 播放/暂停按钮 -->
                        <button id="playPauseBtn" class="control-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        
                        <!-- 音量控制 -->
                        <div class="volume-controls">
                            <button id="muteBtn" class="control-btn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <input 
                                type="range" 
                                id="volumeSlider" 
                                class="volume-slider"
                                min="0" 
                                max="100" 
                                value="100"
                                style="width: 70px;"
                            >
                        </div>
                        
                        <!-- 播放时间 -->
                        <div id="timeDisplay" class="time-display">00:00 / 00:00</div>
                    </div>
                    
                    <div class="right-controls">
                        <!-- 播放速度 -->
                        <select id="speedSelect">
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>1x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>
                        
                        <!-- 下载按钮 -->
                        <button id="downloadBtn" class="control-btn" title="下载视频">
                            <i class="fas fa-download"></i>
                        </button>
                        
                        <!-- 全屏按钮 -->
                        <button id="fullscreenBtn" class="control-btn">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 性能优化：DOM元素缓存
        const dom = {
            videoPlayer: document.getElementById('videoPlayer'),
            playPauseBtn: document.getElementById('playPauseBtn'),
            progressBar: document.getElementById('progressBar'),
            progressFilled: document.getElementById('progressFilled'),
            volumeSlider: document.getElementById('volumeSlider'),
            muteBtn: document.getElementById('muteBtn'),
            timeDisplay: document.getElementById('timeDisplay'),
            speedSelect: document.getElementById('speedSelect'),
            fullscreenBtn: document.getElementById('fullscreenBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            videoContainer: document.getElementById('videoContainer')
        };
        
        // 视频源地址缓存
        const videoSource = dom.videoPlayer.querySelector('source').src;
        
        // 性能优化：节流函数
        function throttle(func, delay = 100) {
            let timer = null;
            return function(...args) {
                if (!timer) {
                    timer = setTimeout(() => {
                        func.apply(this, args);
                        timer = null;
                    }, delay);
                }
            };
        }

        // 播放/暂停切换
        function togglePlayPause() {
            if (dom.videoPlayer.paused) {
                dom.videoPlayer.play().catch(err => {
                    console.error('播放失败:', err);
                    alert('视频播放失败，请检查视频链接或浏览器设置');
                });
                dom.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                dom.videoPlayer.pause();
                dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }
        
        // 节流更新进度条 - 优化：同步更新高亮区域
        const throttledUpdateProgress = throttle(function() {
            if (isNaN(dom.videoPlayer.duration)) return;
            
            // 计算进度百分比
            const progress = (dom.videoPlayer.currentTime / dom.videoPlayer.duration) * 100;
            
            // 更新滑块位置
            dom.progressBar.value = progress;
            
            // 更新高亮区域宽度（核心：实现播放过的地方高亮）
            dom.progressFilled.style.width = `${progress}%`;
            
            // 更新时间显示
            const currentTime = formatTime(dom.videoPlayer.currentTime);
            const duration = formatTime(dom.videoPlayer.duration);
            dom.timeDisplay.textContent = `${currentTime} / ${duration}`;
        }, 30); // 缩短节流时间，让进度条更丝滑

        // 格式化时间
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // 更新音量图标
        function updateVolumeIcon() {
            if (dom.videoPlayer.muted || dom.videoPlayer.volume === 0) {
                dom.muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                dom.volumeSlider.value = 0;
            } else if (dom.videoPlayer.volume < 0.5) {
                dom.muteBtn.innerHTML = '<i class="fas fa-volume-down"></i>';
            } else {
                dom.muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
        }

        // 静音切换
        function toggleMute() {
            dom.videoPlayer.muted = !dom.videoPlayer.muted;
            updateVolumeIcon();
        }

        // 兼容国内浏览器的全屏API
        function toggleFullscreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
                if (dom.videoContainer.requestFullscreen) dom.videoContainer.requestFullscreen();
                else if (dom.videoContainer.webkitRequestFullscreen) dom.videoContainer.webkitRequestFullscreen();
                else if (dom.videoContainer.mozRequestFullScreen) dom.videoContainer.mozRequestFullScreen();
                else if (dom.videoContainer.msRequestFullscreen) dom.videoContainer.msRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
            }
        }

        // 更新全屏图标
        function updateFullscreenIcon() {
            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                dom.fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                dom.fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
            }
        }

        // 视频下载功能
        function downloadVideo() {
            try {
                const downloadLink = document.createElement('a');
                downloadLink.href = videoSource;
                
                // 提取文件名
                let fileName = 'video.mp4';
                const urlParts = videoSource.split('/');
                if (urlParts.length > 0) {
                    const lastPart = urlParts[urlParts.length - 1];
                    if (lastPart.includes('.')) fileName = lastPart;
                }
                
                downloadLink.download = fileName;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                setTimeout(() => {
                    alert('下载已开始，如果未自动下载，请手动复制链接：\n' + videoSource);
                }, 500);
            } catch (err) {
                console.error('下载失败:', err);
                alert('下载失败！\n您可以手动复制视频链接下载：\n' + videoSource);
            }
        }

        // 事件监听
        dom.playPauseBtn.addEventListener('click', togglePlayPause);
        dom.videoPlayer.addEventListener('click', togglePlayPause);
        dom.videoPlayer.addEventListener('timeupdate', throttledUpdateProgress);
        
        // 进度条拖动优化：实时更新高亮
        dom.progressBar.addEventListener('input', function() {
            if (isNaN(dom.videoPlayer.duration)) return;
            
            // 实时更新高亮区域
            const progress = this.value;
            dom.progressFilled.style.width = `${progress}%`;
            
            // 更新视频播放位置
            dom.videoPlayer.currentTime = (progress / 100) * dom.videoPlayer.duration;
            
            // 立即更新时间显示
            const currentTime = formatTime(dom.videoPlayer.currentTime);
            const duration = formatTime(dom.videoPlayer.duration);
            dom.timeDisplay.textContent = `${currentTime} / ${duration}`;
        });
        
        dom.volumeSlider.addEventListener('input', function() {
            dom.videoPlayer.volume = this.value / 100;
            updateVolumeIcon();
        });
        dom.muteBtn.addEventListener('click', toggleMute);
        dom.speedSelect.addEventListener('change', function() {
            dom.videoPlayer.playbackRate = this.value;
        });
        dom.fullscreenBtn.addEventListener('click', toggleFullscreen);
        dom.downloadBtn.addEventListener('click', downloadVideo);
        
        // 全屏事件监听
        ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'].forEach(event => {
            document.addEventListener(event, updateFullscreenIcon);
        });
        
        // 视频结束事件
        dom.videoPlayer.addEventListener('ended', function() {
            dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            dom.progressBar.value = 0;
            dom.progressFilled.style.width = '0%';
        });
        
        // 加载完成事件
        dom.videoPlayer.addEventListener('loadedmetadata', function() {
            throttledUpdateProgress();
        });
        
        // 错误处理
        dom.videoPlayer.addEventListener('error', function(e) {
            console.error('视频加载错误:', e);
            const errorCodes = {
                1: '视频加载被用户中断',
                2: '网络错误导致视频加载失败',
                3: '视频解码失败',
                4: '视频格式不被支持或链接无效'
            };
            alert(`视频加载失败：${errorCodes[e.target.error.code] || '未知错误'}`);
        });
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateVolumeIcon();
            dom.progressBar.value = 0;
            dom.progressFilled.style.width = '0%';
        });
        
        // 页面隐藏时暂停视频
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !dom.videoPlayer.paused) {
                dom.videoPlayer.pause();
                dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });
    </script>
</body>
</html>
